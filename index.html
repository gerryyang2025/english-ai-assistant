<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英语学习小精灵 - 记住么</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📚</text></svg>">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/readings.css">
</head>
<body>
    <div id="app">
        <!-- 头部导航 -->
        <header class="header">
            <div class="header-content">
                <h1 class="logo">📚 英语学习小精灵 - 记住么</h1>
                <nav class="nav-menu">
                    <button class="nav-btn active" data-page="home">首页</button>
                    <button class="nav-btn" data-page="words">单词列表</button>
                    <button class="nav-btn" data-page="flashcard">闪卡测试</button>
                    <button class="nav-btn" data-page="wrongbook">错词本</button>
                    <button class="nav-btn" data-page="favorites">收藏</button>
                    <button class="nav-btn" data-page="readings">阅读</button>
                    <button class="nav-btn" data-page="progress">学习进度</button>
                    <button class="nav-btn" data-page="tool">工具</button>
                </nav>
            </div>
        </header>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 首页 -->
            <section id="page-home" class="page active">
                <div class="hero-section">
                    <h2>📚 你知道下面这个 Joke 的意思吗？</h2>
                    <p id="daily-joke">加载中...</p>
                </div>

                <!-- AI 知识问答 -->
                <div class="ai-qa-section">
                    <h3>🤖 AI 单词助手</h3>
                    <p class="qa-desc">输入英语单词或句子，AI 帮你详细解释用法</p>
                    
                    <div class="qa-input-area">
                        <input type="text" id="qa-input" placeholder="例如: explain the word 'future' or make a sentence with 'pilot'">
                        <button id="qa-submit-btn" onclick="submitQA()">提问</button>
                    </div>
                    
                    <!-- 联网搜索开关 -->
                    <div class="qa-options">
                        <label class="toggle-switch">
                            <input type="checkbox" id="web-search-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label">🌐 联网搜索（获取最新信息）</span>
                    </div>
                    
                    <div id="qa-loading" class="qa-loading" style="display: none;">
                        <div class="loading-spinner"></div>
                        <span>AI 思考中...</span>
                    </div>
                    
                    <div id="qa-result" class="qa-result" style="display: none;">
                        <div class="qa-answer"></div>
                    </div>
                </div>

                <div class="feature-cards">
                    <div class="feature-card" data-action="go-flashcard">
                        <div class="card-icon">📇</div>
                        <h3>闪卡测试</h3>
                        <p>选择单元，进行单词记忆测试</p>
                    </div>
                    <div class="feature-card" data-action="go-words">
                        <div class="card-icon">📚</div>
                        <h3>单词列表</h3>
                        <p>查看所有单元的单词内容</p>
                    </div>
                    <div class="feature-card" data-action="go-progress">
                        <div class="card-icon">📈</div>
                        <h3>学习进度</h3>
                        <p>查看你的学习统计和成就</p>
                    </div>
                </div>

                <!-- 今日统计 -->
                <div class="today-stats">
                    <h3>今日学习</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-number" id="today-reviewed">0</span>
                            <span class="stat-label">已学单词</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="today-correct">0</span>
                            <span class="stat-label">正确数</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="today-accuracy">0%</span>
                            <span class="stat-label">正确率</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="today-readings">0</span>
                            <span class="stat-label">阅读篇数</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="streak-days">0</span>
                            <span class="stat-label">连续天数</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 单词列表页 -->
            <section id="page-words" class="page">
                <div class="page-header">
                    <h2>单词列表</h2>
                    <div class="search-box">
                        <input type="text" id="word-search" placeholder="搜索单词或中文含义...">
                        <button class="search-btn">🔍</button>
                    </div>
                </div>

                <!-- 词书/年级选择 -->
                <div class="wordbook-selector">
                    <label for="wordbook-select">选择词书：</label>
                    <select id="wordbook-select">
                        <!-- 选项由 JS 动态生成 -->
                    </select>
                </div>

                <!-- 单元标签页 -->
                <div class="unit-tabs" id="unit-tabs">
                    <!-- 单元标签将由 JS 动态生成 -->
                </div>

                <!-- 单词列表 -->
                <div class="word-list" id="word-list">
                    <!-- 单词列表将由 JS 动态生成 -->
                </div>
            </section>

            <!-- 闪卡测试页 -->
            <section id="page-flashcard" class="page">
                <!-- 测试设置区域 -->
                <div id="flashcard-setup" class="setup-section">
                    <h2>闪卡测试设置</h2>
                    
                    <!-- 词书/年级选择 -->
                    <div class="setup-group">
                        <h3>选择词书</h3>
                        <div class="wordbook-selector-flashcard">
                            <select id="flashcard-wordbook-select">
                                <!-- 词书选项将由 JS 动态生成 -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="setup-group">
                        <h3>选择单元（可多选）</h3>
                        <div class="unit-select-grid" id="flashcard-unit-select-grid">
                            <!-- 单元选择将由 JS 动态生成 -->
                        </div>
                        <div class="select-actions">
                            <button class="btn-secondary" id="flashcard-select-all-units">全选</button>
                            <button class="btn-secondary" id="flashcard-clear-unit-selection">清空</button>
                        </div>
                    </div>

                    <div class="setup-group">
                        <h3>测试模式</h3>
                        <div class="mode-options">
                            <label class="mode-option">
                                <input type="radio" name="test-mode" value="en-to-zh" checked>
                                <span class="mode-label">英文 → 中文</span>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="test-mode" value="zh-to-en">
                                <span class="mode-label">中文 → 英文</span>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="test-mode" value="mixed">
                                <span class="mode-label">混合模式</span>
                            </label>
                        </div>
                    </div>

                    <button class="btn-primary btn-large" id="start-test-btn">
                        开始测试
                    </button>
                </div>

                <!-- 闪卡测试区域 -->
                <div id="flashcard-test" class="test-section" style="display: none;">
                    <!-- 进度条 -->
                    <div class="test-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="test-progress-fill"></div>
                        </div>
                        <span class="progress-text" id="progress-text">1 / 10</span>
                    </div>

                    <!-- 闪卡 -->
                    <div class="flashcard" id="flashcard">
                        <div class="flashcard-inner">
                            <!-- 正面：问题 -->
                            <div class="flashcard-front">
                                <div class="question-label" id="question-label">英文</div>
                                <div class="question-text" id="question-text">future</div>
                                <button class="btn-reveal" id="btn-reveal">查看答案</button>
                            </div>
                            
                            <!-- 反面：答案 -->
                            <div class="flashcard-back">
                                <!-- 单词来源信息 -->
                                <div class="answer-source" id="answer-source"></div>
                                <div class="answer-word" id="answer-word" onclick="speakCurrentWord()" style="cursor: pointer;" title="点击播放英音">
                                    future
                                    <span class="speak-hint">🇬🇧</span>
                                </div>
                                <div class="answer-phonetic-wrapper">
                                    <div class="answer-phonetic" id="answer-phonetic">/ˈfjuːtʃə/</div>
                                    <button class="phonetic-audio-btn" onclick="speakCurrentWord()" title="播放英音">🇬🇧</button>
                                    <button class="phonetic-audio-btn" onclick="speakCurrentWordUS()" title="播放美音">🇺🇸</button>
                                </div>
                                <div class="answer-meaning" id="answer-meaning">将来；未来</div>
                                <div class="answer-example" id="answer-example">
                                    <p class="example-en">I want to be a teacher in the future.</p>
                                    <p class="example-zh">我将来想成为一名老师。</p>
                                </div>
                                <div class="answer-tip" id="answer-tip"></div>
                                <div class="answer-actions">
                                    <button class="btn-known" id="btn-known">
                                        <span class="btn-icon">✅</span>
                                        记住了
                                    </button>
                                    <button class="btn-unknown" id="btn-unknown">
                                        <span class="btn-icon">❌</span>
                                        没记住
                                    </button>
                                    <button class="btn-review" id="btn-review">
                                        <span class="btn-icon">🔖</span>
                                        稍后复习
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 退出测试 -->
                    <button class="btn-exit" id="btn-exit-test">退出测试</button>
                </div>

                <!-- 测试结果区域 -->
                <div id="flashcard-result" class="result-section" style="display: none;">
                    <h2>测试完成！</h2>
                    
                    <div class="result-stats">
                        <div class="result-circle">
                            <svg viewBox="0 0 100 100">
                                <circle class="circle-bg" cx="50" cy="50" r="45"/>
                                <circle class="circle-progress" id="result-circle" cx="50" cy="50" r="45"/>
                            </svg>
                            <div class="result-percent" id="result-percent">85%</div>
                        </div>
                        
                        <div class="result-details">
                            <div class="result-row">
                                <span class="result-label">总题数</span>
                                <span class="result-value" id="result-total">20</span>
                            </div>
                            <div class="result-row correct">
                                <span class="result-label">正确</span>
                                <span class="result-value" id="result-correct">17</span>
                            </div>
                            <div class="result-row wrong">
                                <span class="result-label">错误</span>
                                <span class="result-value" id="result-wrong">3</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">用时</span>
                                <span class="result-value" id="result-time">2:30</span>
                            </div>
                        </div>
                    </div>

                    <div class="result-actions">
                        <button class="btn-primary" id="retry-test-btn">再测一次</button>
                        <button class="btn-secondary" id="review-wrong-btn">复习错词</button>
                        <button class="btn-secondary" id="back-home-btn">返回首页</button>
                    </div>
                </div>
            </section>

            <!-- 错词本页 -->
            <section id="page-wrongbook" class="page">
                <h2>📝 错词本</h2>
                
                <!-- 分类说明 -->
                <div class="mastery-legend">
                    <span class="legend-title">分类说明：</span>
                    <span class="legend-item"><span class="legend-badge mastered">已掌握</span> 熟练度 ≥ 4</span>
                    <span class="legend-item"><span class="legend-badge learning">学习中</span> 熟练度 2-3</span>
                    <span class="legend-item"><span class="legend-badge review">待复习</span> 熟练度 0-1</span>
                    <span class="legend-note">（答对+1，答错-1，最高5级）</span>
                </div>
                
                <!-- 错词统计 -->
                <div class="wrongbook-stats">
                    <div class="stat-card">
                        <div class="stat-icon">📕</div>
                        <div class="stat-info">
                            <span class="stat-value" id="wrongbook-count">0</span>
                            <span class="stat-desc">当前错词数</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🌟</div>
                        <div class="stat-info">
                            <span class="stat-value" id="wrongbook-mastery">0</span>
                            <span class="stat-desc">已掌握词数</span>
                        </div>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="wrongbook-actions">
                    <button class="btn-primary" id="review-all-wrong-btn" onclick="reviewAllWrongWords()">
                        🔁 复习全部错词
                    </button>
                    <button class="btn-secondary" id="clear-wrongbook-btn" onclick="clearWrongbook()">
                        🗑️ 清空错词本
                    </button>
                </div>

                <!-- 错词列表 -->
                <div class="wrongbook-list-section">
                    <h3>错词列表</h3>
                    <div class="wrongbook-words" id="wrongbook-words">
                        <p class="empty-message">🎉 恭喜！错词本为空，继续保持！</p>
                    </div>
                </div>
            </section>

            <!-- 收藏单词页 -->
            <section id="page-favorites" class="page">
                <div class="page-header">
                    <h2>收藏的单词</h2>
                    <div class="favorites-stats" id="favorites-stats">
                        <span class="stat-badge">❤️ 共收藏 <span id="favorites-count">0</span> 个单词</span>
                    </div>
                </div>
                
                <!-- 收藏单词列表 -->
                <div class="favorites-list" id="favorites-list">
                    <p class="empty-message">📝 还没有收藏任何单词</p>
                </div>
            </section>

            <!-- 学习进度页 -->
            <section id="page-progress" class="page">
                <h2>学习进度</h2>
                
                <!-- 总体统计 -->
                <div class="overall-stats">
                    <div class="stat-card">
                        <div class="stat-icon">📚</div>
                        <div class="stat-info">
                            <span class="stat-value" id="total-words">0</span>
                            <span class="stat-desc">总单词数</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🎉</div>
                        <div class="stat-info">
                            <span class="stat-value" id="mastered-words">0</span>
                            <span class="stat-desc">已掌握</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">📈</div>
                        <div class="stat-info">
                            <span class="stat-value" id="overall-accuracy">0%</span>
                            <span class="stat-desc">总体正确率</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🔥</div>
                        <div class="stat-info">
                            <span class="stat-value" id="total-streak">0</span>
                            <span class="stat-desc">连续学习(天)</span>
                        </div>
                    </div>
                </div>

                <!-- 单词进度 -->
                <div class="unit-progress-section">
                    <h3>📚 单词进度</h3>
                    <div class="unit-progress-list" id="unit-progress-list">
                        <!-- 单元进度将由 JS 动态生成 -->
                    </div>
                </div>

                <!-- 阅读进度 -->
                <div class="reading-progress-section">
                    <h3>📖 阅读进度</h3>
                    <div class="reading-stats">
                        <div class="reading-stat-card">
                            <div class="reading-stat-icon">📖</div>
                            <div class="reading-stat-info">
                                <span class="reading-stat-value" id="total-readings">0</span>
                                <span class="reading-stat-desc">阅读篇数</span>
                            </div>
                        </div>
                        <div class="reading-stat-card">
                            <div class="reading-stat-icon">✅</div>
                            <div class="reading-stat-info">
                                <span class="reading-stat-value" id="completed-readings">0</span>
                                <span class="reading-stat-desc">已读完</span>
                            </div>
                        </div>
                        <div class="reading-stat-card">
                            <div class="reading-stat-icon">📊</div>
                            <div class="reading-stat-info">
                                <span class="reading-stat-value" id="reading-progress-percent">0%</span>
                                <span class="reading-stat-desc">完成率</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 阅读列表页面 -->
            <section id="page-readings" class="page">
                <div class="page-header">
                    <h1>📖 英语阅读</h1>
                    <p class="page-subtitle">选择一篇阅读材料开始跟读练习</p>
                </div>
                
                <div class="readings-grid" id="readings-list">
                    <!-- 阅读卡片由 JS 动态生成 -->
                </div>
            </section>

            <!-- 阅读详情页面 -->
            <section id="page-reading-detail" class="page">
                <div class="reading-header">
                    <button class="back-btn" onclick="showReadingsPage()">
                        <span class="back-icon">←</span> 返回列表
                    </button>
                    <h1 class="reading-title" id="reading-title">Title</h1>
                    <p class="reading-scene" id="reading-scene">Scene description</p>
                </div>
                
                <!-- 重点句型 -->
                <div class="key-patterns-section" id="key-patterns-section">
                    <h3>📝 重点句型</h3>
                    <div class="key-patterns-list" id="key-patterns-list">
                        <!-- 重点句型由 JS 动态生成 -->
                    </div>
                </div>
                
                <!-- 知识点 -->
                <div class="knowledge-points-section" id="knowledge-points-section">
                    <h3>📚 知识点</h3>
                    <div class="knowledge-points-list" id="knowledge-points-list">
                        <!-- 知识点由 JS 动态生成 -->
                    </div>
                </div>
                
                <div class="reading-content" id="reading-content">
                    <!-- 对话内容由 JS 动态生成 -->
                </div>
                
                <div class="reading-controls">
                    <button class="btn-primary" id="play-all-btn" onclick="playAllDialogues()">
                        🔊 播放全部
                    </button>
                    <button class="btn-secondary" onclick="stopPlayback()">⏹ 停止</button>
                    <button class="btn-secondary" id="mark-read-btn" onclick="markCurrentReadingCompleted()">✅ 标记已读</button>
                </div>
            </section>
            
            <!-- 工具页面 -->
            <section id="page-tool" class="page">
                <div class="page-header">
                    <h1>🔧 数据更新工具</h1>
                    <p class="page-subtitle">将 Markdown 文件转换为网站可用的 JSON 数据格式，或直接上传 JSON 文件实时生效</p>
                </div>
                
                <div class="tool-container">
                    <div class="tool-tabs">
                        <button class="tool-tab active" data-tab="words">单词数据</button>
                        <button class="tool-tab" data-tab="readings">阅读数据</button>
                    </div>
                    
                    <!-- 单词数据 -->
                    <div class="tool-content active" id="tool-words">
                        <div class="upload-section">
                            <h3>📖 上传 Markdown 文件</h3>
                            <div class="upload-area" id="wordsMdUploadArea">
                                <div class="upload-icon">📄</div>
                                <div class="upload-text">点击或拖拽 WORDS.md 文件到此处</div>
                                <div class="upload-hint">支持 .md 格式的文件</div>
                            </div>
                            <input type="file" id="wordsMdFileInput" accept=".md,.txt" style="display: none;">
                        </div>
                        
                        <!-- 格式说明 -->
                        <div class="format-help">
                            <h4>📋 Markdown 格式要求</h4>
                            <div class="format-example">
                                <pre># 英语五年级上册单词

## Unit 1 My future
Title:My future Category:职业类

* future /ˈfjuːtʃə/ 将来；未来
  - 例句：I want to be a teacher in the future. (我将来想成为一名老师。)
  - 记忆：future = fu + ture

* want /wɒnt/ 想要
  - 例句：I want an apple. (我想要一个苹果。)

## Unit 2 What subjects do you like?
Title:What subjects do you like? Category:学科类

* subject /ˈsʌbdʒekt/ 学科；主题
  - 例句：What subject do you like? (你喜欢什么学科？)
  - 记忆：sub + ject</pre>
                            </div>
                        </div>
                        
                        <div class="upload-section json-upload">
                            <h3>📋 上传 JSON 文件（实时生效）</h3>
                            <div class="upload-area json" id="wordsJsonUploadArea">
                                <div class="upload-icon">⚡</div>
                                <div class="upload-text">点击或拖拽 words.json 文件到此处</div>
                                <div class="upload-hint">上传后立即生效，无需刷新页面</div>
                            </div>
                            <input type="file" id="wordsJsonFileInput" accept=".json" style="display: none;">
                        </div>
                        
                        <div class="file-info" id="wordsFileInfo" style="display: none;">
                            <div class="file-name" id="wordsFileName"></div>
                            <div class="file-size" id="wordsFileSize"></div>
                        </div>
                        <div class="preview" id="wordsPreview" style="display: none;">
                            <div class="preview-title">数据预览：</div>
                            <ul class="wordbook-list" id="wordbookList"></ul>
                        </div>
                        <div class="actions" id="wordsActions" style="display: none;">
                            <button class="btn" id="wordsGenerateBtn">生成并下载 words.json</button>
                            <button class="btn btn-secondary" id="wordsCopyBtn">复制 JSON 到剪贴板</button>
                        </div>
                        <div class="status" id="wordsStatus"></div>
                    </div>
                    
                    <!-- 阅读数据 -->
                    <div class="tool-content" id="tool-readings">
                        <div class="upload-section">
                            <h3>📚 上传 Markdown 文件</h3>
                            <div class="upload-area reading" id="readingsMdUploadArea">
                                <div class="upload-icon">📄</div>
                                <div class="upload-text">点击或拖拽 READINGS.md 文件到此处</div>
                                <div class="upload-hint">支持 .md 格式的文件</div>
                            </div>
                            <input type="file" id="readingsMdFileInput" accept=".md,.txt" style="display: none;">
                        </div>
                        
                        <!-- 格式说明 -->
                        <div class="format-help">
                            <h4>📋 Markdown 格式要求</h4>
                            <div class="format-example">
                                <pre># 题目：My future (我的未来)
# 场景：讨论未来的职业理想

# 重点句型：
  - What do you want to be? (你将来想做什么？)
  - I want to be a doctor. (我想成为一名医生。)

# 知识点：
  - **want to be** 表示"想成为"
  - 使用 `code` 标记关键单词

# 对话：
Teacher: What do you want to be when you grow up? (老师：你长大后想做什么？)
Tom: I want to be a doctor. (汤姆：我想成为一名医生。)

</pre>
                            </div>
                        </div>
                        
                        <div class="upload-section json-upload">
                            <h3>⚡ 上传 JSON 文件（实时生效）</h3>
                            <div class="upload-area json reading" id="readingsJsonUploadArea">
                                <div class="upload-icon">🚀</div>
                                <div class="upload-text">点击或拖拽 readings.json 文件到此处</div>
                                <div class="upload-hint">上传后立即生效，无需刷新页面</div>
                            </div>
                            <input type="file" id="readingsJsonFileInput" accept=".json" style="display: none;">
                        </div>
                        
                        <div class="file-info" id="readingsFileInfo" style="display: none;">
                            <div class="file-name reading" id="readingsFileName"></div>
                            <div class="file-size" id="readingsFileSize"></div>
                        </div>
                        <div class="preview" id="readingsPreview" style="display: none;">
                            <div class="preview-title">数据预览：</div>
                            <ul class="reading-list" id="readingList"></ul>
                        </div>
                        <div class="actions" id="readingsActions" style="display: none;">
                            <button class="btn btn-reading" id="readingsGenerateBtn">生成并下载 readings.json</button>
                            <button class="btn btn-secondary" id="readingsCopyBtn">复制 JSON 到剪贴板</button>
                        </div>
                        <div class="status" id="readingsStatus"></div>
                    </div>
                </div>
            </section>
        </main>

        <!-- 底部 -->
        <footer class="footer">
            <p>英语学习小精灵 - 记住么 © 2026 | Made with ❤️ by gerryyang</p>
        </footer>
    </div>

    <!-- 加载动画 -->
    <div class="loading-overlay" id="loading">
        <div class="loading-spinner"></div>
        <p>加载中...</p>
    </div>

    <!-- 服务不可用提示 -->
    <div class="error-overlay" id="service-error">
        <div class="error-content">
            <div class="error-icon">⚠️</div>
            <h2>服务暂时不可用</h2>
            <p>服务器连接失败，请确保服务正在运行</p>
            <p class="error-hint">请刷新页面重试，或联系管理员</p>
            <button class="btn-primary" onclick="location.reload()">刷新页面</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
